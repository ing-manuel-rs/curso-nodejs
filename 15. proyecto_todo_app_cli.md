# **To Do App desde consola**


## **ConfiguraciÃ³n**

Primero inicializamos nuestro proyecto con `npm init -y`

```json
{
Â  Â  "name": "todo-list-cli",
Â  Â  "version": "1.0.0",
Â  Â  "description": "ToDo List CLI",
Â  Â  "main": "app.js",
Â  Â  "type": "module",
Â  Â  "scripts": {
Â  Â  Â  Â  "test": "echo \"Error: no test specified\" && exit 1"
Â  Â  },
Â  Â  "keywords": [],
Â  Â  "author": "Manuel",
Â  Â  "license": "ISC",
Â  Â  "dependencies": {
Â  Â  }
}
```

Instalamos el paquete chalk que sirve para darle colores a la consola

```bash
npm i chalk
```

Ahora, para mantener a la escucha los cambios del archivo app.js, es decir, que se vuelva a ejecutar el archivo cada que hay algÃºn cambio en este hay dos maneras:

1. Instalando nodemon, que es una dependencia para actualizar los resultados cada que hay un cambio en el archivo especificado 

```bash
npm install -D nodemon
```

2. A partir de la versiÃ³n v18 de Node JS podemos usar la bandera `--watch` para mantenernos a la escucha de los cambios de un archivo y actualizar automÃ¡ticamente los resultados 

```bash
node --watch app.js
```

**Nota:** Este comando lo podemos meter en un script personalizado

```json
"start": "node --watch app.js"
```

Y lo ejecutamos con `npm start` (ya que "start" es el Ãºnico comando que no necesita el `run`)

En este caso vamos a usar nodemon, asÃ­ que seguimos los siguientes pasos 

Instalar [nodemon](https://www.npmjs.com/package/nodemon) (la podemos instalar globalmente o como devDependencie)

```bash
npm i -D nodemon
```

Y lo ejecutamos con 

```bash
nodemon app.js
```

O creando el script

```json
"dev": "nodemon app.js"
```

Y lo ejecutamos con `npm run dev`


## **CÃ³digo**

Este cÃ³digo maneja la informaciÃ³n en memoria, es decir, la informaciÃ³n se pierde en cada ejecuciÃ³n 

```javascript
import { createInterface } from "readline";
import chalk from "chalk";
  
const tasks = [];

// Creacion de interface para interactuar con la consola
const rl = createInterface({
Â  Â  // process es el objeto global que te da acceso al proceso en ejecuciÃ³n de Node
Â  Â  input: process.stdin,
Â  Â  output: process.stdout,
});
  
function displayMenu() {
Â  Â  console.log(chalk.yellow.bold("***** To Do App *****"));
Â  Â  console.log("1. Agregar tarea");
Â  Â  console.log("2. Listar tareas");
Â  Â  console.log("3. Completar tarea");
Â  Â  console.log("4. Salir");
Â  Â  console.log("\n\n");
}

function addTask() {
Â  Â  rl.question(chalk.bgMagentaBright("Escribe la tarea: "), (task) => {
Â  Â  Â  Â  tasks.push({ task, completed: false });
Â  Â  Â  Â  console.log(chalk.green.bold("Tarea agregada con exito\n\n"));
Â  Â  Â  Â  displayMenu();
Â  Â  Â  Â  chooseOption();
Â  Â  });
}
  
function listsTasks() {
Â  Â  console.log(chalk.yellow.bold("\n***** Tareas *****\n"));
Â  Â  if (tasks.length === 0) {
Â  Â  Â  Â  console.log(chalk.bgGreen("No hay tareas por hacer ðŸ˜Š\n\n"));
Â  Â  } else {
Â  Â  Â  Â  tasks.forEach((task, index) => {
Â  Â  Â  Â  Â  Â  let status = task.completed ? "âœ…" : "âŒ";
Â  Â  Â  Â  Â  Â  if (task.completed) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chalk.greenBright(`${index + 1}. ${status} - ${task.task}`)
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chalk.redBright(`${index + 1}. ${status} - ${task.task}`)
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
Â  Â  displayMenu();
Â  Â  chooseOption();
}
  
function completeTask() {
Â  Â  rl.question(
Â  Â  Â  Â  chalk.bgMagentaBright("Digita el numero de la tarea a completar: "),
Â  Â  Â  Â  (taskNumber) => {
Â  Â  Â  Â  Â  Â  const index = parseInt(taskNumber) - 1;
Â  Â  Â  Â  Â  Â  if (index >= 0 && index < tasks.length) {
Â  Â  Â  Â  Â  Â  Â  Â  tasks[index].completed = true;
Â  Â  Â  Â  Â  Â  Â  Â  console.log(chalk.green.bold("Tarea marcada con exito âœ…\n\n"));
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(chalk.red.bold("Numero de tarea invalido\n\n"));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  displayMenu();
Â  Â  Â  Â  Â  Â  chooseOption();
Â  Â  Â  Â  }
Â  Â  );
}
  
function chooseOption() {
Â  Â  rl.question("Elige una opcion: ", (choice) => {
Â  Â  Â  Â  switch (choice) {
Â  Â  Â  Â  Â  Â  case "1":
Â  Â  Â  Â  Â  Â  Â  Â  addTask();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case "2":
Â  Â  Â  Â  Â  Â  Â  Â  listsTasks();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case "3":
Â  Â  Â  Â  Â  Â  Â  Â  completeTask();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case "4":
Â  Â  Â  Â  Â  Â  Â  Â  console.log(chalk.yellow("Adios"));
Â  Â  Â  Â  Â  Â  Â  Â  // Terminar comunicacion con la terminal y devolver el cursor
Â  Â  Â  Â  Â  Â  Â  Â  rl.close();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  Â  Â  Â  console.log(chalk.red("Opcion invalida, intentalo de nuevo\n"));
Â  Â  Â  Â  Â  Â  Â  Â  displayMenu();
Â  Â  Â  Â  Â  Â  Â  Â  chooseOption();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  }
Â  Â  });
}
  
displayMenu();
chooseOption();
```


Este cÃ³digo maneja persistencia de datos almacenÃ¡ndolos en un archivo de texto con el modulo `fs` de node (este lo veremos mas adelante)

```javascript
import { read, readFile, readFileSync, writeFileSync } from "fs";
import { createInterface } from "readline";
import chalk from "chalk";
  
const tasks = [];
const DB_FILE = "tasks.txt";
  
// Creacion de interface para interactuar con la consola
const rl = createInterface({
Â  Â  // process es el objeto global que te da acceso al proceso en ejecuciÃ³n de Node
Â  Â  input: process.stdin,
Â  Â  output: process.stdout,
});
  
function displayMenu() {
Â  Â  console.log(chalk.yellow.bold("***** To Do App *****"));
Â  Â  console.log("1. Agregar tarea");
Â  Â  console.log("2. Listar tareas");
Â  Â  console.log("3. Completar tarea");
Â  Â  console.log("4. Salir");
Â  Â  console.log("\n\n");
}
  
function loadTasks() {
Â  Â  try {
Â  Â  Â  Â  const data = readFileSync(DB_FILE, "utf-8");
Â  Â  Â  Â  const lines = data.split("\n");
Â  Â  Â  Â  tasks.length = 0;
Â  Â  Â  Â  
Â  Â  Â  Â  lines.forEach((line) => {
Â  Â  Â  Â  Â  Â  if (line.trim() !== "") {
Â  Â  Â  Â  Â  Â  Â  Â  const { task, completed } = line.split("|");
Â  Â  Â  Â  Â  Â  Â  Â  tasks.push({ task, completed: completed === true });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  Â  console.log(
Â  Â  Â  Â  Â  Â  chalk.green.bold("Las tareas se han cargado desde la BD\n")
Â  Â  Â  Â  );
Â  Â  } catch (erro) {
Â  Â  Â  Â  console.log(chalk.green.bold("No hay tareas por hacer\n"));
Â  Â  }
}

function saveTask() {
Â  Â  const data = tasks
Â  Â  Â  Â  .map((task) => `${task.task}|${task.completed}`)
Â  Â  Â  Â  .join("\n");
Â  Â  writeFileSync(DB_FILE, data, "utf-8");
Â  Â  console.log(chalk.green.bold("Tarea agregada a la BD con exito"));
}

function addTask() {
Â  Â  rl.question(chalk.bgMagentaBright("Escribe la tarea: "), (task) => {
Â  Â  Â  Â  tasks.push({ task, completed: false });
Â  Â  Â  Â  console.log(chalk.green.bold("Tarea agregada con exito\n\n"));
Â  Â  Â  Â  saveTask();
Â  Â  Â  Â  displayMenu();
Â  Â  Â  Â  chooseOption();
Â  Â  });
}
  
function listsTasks() {
Â  Â  console.log(chalk.yellow.bold("\n***** Tareas *****\n"));
Â  Â  if (tasks.length === 0) {
Â  Â  Â  Â  console.log(chalk.bgGreen("No hay tareas por hacer ðŸ˜Š\n\n"));
Â  Â  } else {
Â  Â  Â  Â  tasks.forEach((task, index) => {
Â  Â  Â  Â  Â  Â  let status = task.completed ? "âœ…" : "âŒ";
Â  Â  Â  Â  Â  Â  if (task.completed) {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chalk.greenBright(`${index + 1}. ${status} - ${task.task}`)
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chalk.redBright(`${index + 1}. ${status} - ${task.task}`)
Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  }
Â  Â  displayMenu();
Â  Â  chooseOption();
}
  
function completeTask() {
Â  Â  rl.question(
Â  Â  Â  Â  chalk.bgMagentaBright("Digita el numero de la tarea a completar: "),
Â  Â  Â  Â  (taskNumber) => {
Â  Â  Â  Â  Â  Â  const index = parseInt(taskNumber) - 1;
Â  Â  Â  Â  Â  Â  if (index >= 0 && index < tasks.length) {
Â  Â  Â  Â  Â  Â  Â  Â  tasks[index].completed = true;
Â  Â  Â  Â  Â  Â  Â  Â  saveTask();
Â  Â  Â  Â  Â  Â  Â  Â  console.log(chalk.green.bold("Tarea marcada con exito âœ…\n\n"));
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  console.log(chalk.red.bold("Numero de tarea invalido\n\n"));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  displayMenu();
Â  Â  Â  Â  Â  Â  chooseOption();
Â  Â  Â  Â  }
Â  Â  );
}
  
function chooseOption() {
Â  Â  rl.question("Elige una opcion: ", (choice) => {
Â  Â  Â  Â  switch (choice) {
Â  Â  Â  Â  Â  Â  case "1":
Â  Â  Â  Â  Â  Â  Â  Â  addTask();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case "2":
Â  Â  Â  Â  Â  Â  Â  Â  listsTasks();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case "3":
Â  Â  Â  Â  Â  Â  Â  Â  completeTask();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  case "4":
Â  Â  Â  Â  Â  Â  Â  Â  console.log(chalk.yellow("Adios"));
Â  Â  Â  Â  Â  Â  Â  Â  // Terminar comunicacion con la terminal y devolver el cursor
Â  Â  Â  Â  Â  Â  Â  Â  rl.close();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  Â  Â  Â  console.log(chalk.red("Opcion invalida, intentalo de nuevo\n"));
Â  Â  Â  Â  Â  Â  Â  Â  displayMenu();
Â  Â  Â  Â  Â  Â  Â  Â  chooseOption();
Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  }
Â  Â  });
}

loadTasks();
displayMenu();
chooseOption();
```

